<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Otonomic Site Creation Page">
    <meta name="author" content="Otonomic">
    <link rel="shortcut icon" href="/favicon.ico">

    <title>Otonomic is creating your site...</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- progress.js -->
    <link href="js/progress.js/progressjs.min.css" rel="stylesheet">

    <!-- owl-carousel -->
    <link href="js/owl-carousel/owl.carousel.css" rel="stylesheet">
    <link href="js/owl-carousel/owl.theme.css" rel="stylesheet">
    <link href="js/owl-carousel/owl.transitions.css" rel="stylesheet">

    <!-- Custom styles for this template -->
    <link href="css/wp-loading-page.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

    <script src="/js/otonomic-analytics.js"></script>
  </head>

  <body class="wp-lp">
    <div class="navbar navbar-inverse" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <div class="center-logo-holder">
            <div class="center-logo center-block text-center" style="top: 9px;">
              <img src="images/otonomic-logo.png" class="logo-img" alt="otonomic logo">
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="container-fluid">
      <div class="row">
        <div id="progress-bar"></div>
      </div>
    </div>
    <div class="container-fluid">
        <div class="row">
          <div class="col-xs-12 text-center">
            <div id="owl-slider" class="owl-carousel owl-theme">

              <div class="item"><!-- 1 -->
                <h2 class="progress-text">Creating website layout...</h2>
                <p><img src="images/card.png"></p>
                <h3><b>Get a website full of your own content from Facebook</b></h3>
              </div>
              <div class="item"><!-- 2 -->
                <h2 class="progress-text">Collecting information about your business...</h2>
                <p><img src="images/card.png"></p>
                <h3>Get a website full of your own content from Facebook</h3>
                <p><img src="images/mobilev.png"></p>
                <h3><b>Compatible with mobile phones and tablets</b></h3>
              </div>
              <div class="item"><!-- 3 -->
                <h2 class="progress-text">Creating a Home page...</h2>
                <p><img src="images/card.png"></p>
                <h3>Get a website full of your own content from Facebook</h3>
                <p><img src="images/mobilev.png"></p>
                <h3>Compatible with mobile phones and tablets</h3>
                <p><img src="images/google.png"></p>
                <h3><b>It can be found on Google search</b><h3>
              </div>
              <div class="item"><!-- 4 -->
                <h2 class="progress-text">Copying posts from your Facebook page...</h2>
                <p><img src="images/card.png"></p>
                <h3>Get a website full of your own content from Facebook</h3>
                <p><img src="images/mobilev.png"></p>
                <h3>Compatible with mobile phones and tablets</h3>
                <p><img src="images/google.png"></p>
                <h3>It can be found on Google search</h3>
                <p><img src="images/gift.png"></p>
                <h3><b>And absolutely free!</b></h3>
              </div>
              <div class="item"><!-- 5 -->
                <h2 class="progress-text">Creating New page...</h2>
                <p><img src="images/card.png"></p>
                <h3>Get a website full of your own content from Facebook</h3>
                <p><img src="images/mobilev.png"></p>
                <h3>Compatible with mobile phones and tablets</h3>
                <p><img src="images/google.png"></p>
                <h3>It can be found on Google search</h3>
                <p><img src="images/gift.png"></p>
                <h3>And absolutely <b>free</b>!</h3>
              </div>
              <div class="item"><!-- 6 -->
                <h2 class="progress-text">Creating Image Gallery page...</h2>
                <div class="row">
                  <div class="col-md-2 col-md-offset-1 text-left">
                    <h2 class="behold">You can choose one of these gorgeous free business templates...</h2>
                  </div>
                </div>
              </div>
              <div class="item"><!-- 7 -->
                <h2 class="progress-text">Creating your website’s Gallery page...</h2>
                <div class="row">
                  <div class="col-md-2 col-md-offset-1 text-left">
                    <h2 class="behold">You can choose one of these gorgeous free business templates...</h2>
                  </div>
                  <div class="col-md-9">
                    <div class="devices-holder">
                      <div class="desktop"><img src="images/desktop.png"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="item"><!-- 8 -->
                <h2 class="progress-text">Copying customer testimonials from your Facebook page...</h2>
                <div class="row">
                  <div class="col-md-2 col-md-offset-1 text-left">
                    <h2 class="behold">You can choose one of these gorgeous free business templates...</h2>
                  </div>
                  <div class="col-md-9">
                    <div class="devices-holder">
                      <div class="desktop"><img src="images/desktop.png"></div>
                      <div class="ipad"><img src="images/ipad.png"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="item"><!-- 9 -->
                <h2 class="progress-text">Creating Testimonials page...</h2>
                <div class="row">
                  <div class="col-md-2 col-md-offset-1 text-left">
                    <h2 class="behold">You can choose one of these gorgeous free business templates...</h2>
                  </div>
                  <div class="col-md-9">
                    <div class="devices-holder">
                      <div class="desktop"><img src="images/desktop.png"></div>
                      <div class="ipad"><img src="images/ipad.png"></div>
                      <div class="iphone"><img src="images/iphone.png"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="item"><!-- 10 -->
                <h2 class="progress-text">Looking for Social Media accounts...</h2>
                <div class="row">
                  <div class="col-md-2 col-md-offset-1 text-left">
                    <h2 class="behold">You can choose one of these gorgeous free business templates...</h2>
                  </div>
                  <div class="col-md-9">
                    <div class="devices-holder">
                      <div class="desktop"><img src="images/desktop.png"></div>
                      <div class="ipad"><img src="images/ipad.png"></div>
                      <div class="iphone"><img src="images/iphone.png"></div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="item"><!-- 11 -->
                <h2 class="progress-text">Creating Social Media page...</h2>
                <p><img src="images/dollar.png"></p>
                <h3>You don’t have to worry about costs....</h3>
                <h1>Basic websites are completely <b>free of charge.</b></h1>
              </div>
              <div class="item"><!-- 12 -->
                <h2 class="progress-text">Collecting your contact information from your Facebook page...</h2>
                <p><img src="images/dollar.png"></p>
                <h3>You don’t have to worry about costs....</h3>
                <h1>Basic websites are completely <b>free of charge.</b></h1>
              </div>
              <div class="item"><!-- 13 -->
                <h2 class="progress-text">Copying your contact information from your Facebook page...</h2>
                <div class="container">
                  <div class="col-md-1 col-md-offset-2 text-right">
                    <img class="location" src="images/location.png">
                  </div>
                  <div class="col-md-8 text-left">
                    <h4>It seems that some contact details are missing<br/>
                    from your Facebook page.</h4>
                    <h4>It’s important for you to fill them, because websites that<br/>
                    don’t have contact details are considered by customers<br/>
                    as less reliable.</h4>
                    <form role="form" id="business-details" action="">
                      <div class="row">
                        <div class="col-xs-12 col-md-6">
                            <div class="form-group">
                                <label for="productName">Business address</label>
                                <textarea rows="3" id="address" name="address" class="form-control" placeholder="Enter your business’ physical address here..." autocomplete="off"></textarea>
                            </div>
                            <div class="form-group">
                                <label for="email">Email</label>
                                <input type="email" class="form-control" id="email" name="email" value="" placeholder="">
                            </div>
                            <div class="form-group">
                                <label for="phoneNum">Phone number</label>
                                <input type="text" class="form-control" id="phone" name="phone" value="" placeholder="">
                            </div>
                            <div class="form-group text-center">
                              <a href="#" onclick="return false;" class="submit btn btn-ttc btn-lg" id="contact-form-btn"><span class="glyphicon glyphicon-ok"></span> Done </a>
                              <h4>Your contact details will appear on your website. We will never misuse them for any other purpose..</h4>
                              <a href="#" onclick="return false;" class="submit-skip" ><h4><u>I don’t want a Contact page in my website</u></h4></a>
                            </div>
                        </div>
                        <div class="col-xs-12 col-md-6">
                          <div class="map_canvas"></div>
                        </div>
                      </div>
                    </form>
                  </div>
                </div>
              </div>
              <div class="item"><!-- 14 -->
                <h2 class="progress-text">Creating your website’s Contact page...</h2>
                <p class="text-center"><span class="glyphicon glyphicon-thumbs-up"></span></p>
                <!-- <h3>Just reminding you that...</h3> -->
                <h1>Your Facebook page is completely safe.</h1>
                <h3>We’re only copying information to your new site.<br>There will be absolutely no changes to your Facebook page.</h3>
              </div>
              <div class="item"><!-- 15 -->
                <h2 class="progress-text">Creating an Online Store...</h2>
                <p><img src="images/store.png" style="margin-bottom:20px;"></p>
                <h3 style="margin-bottom:20px;">Would you like to sell your products online?</h3>
                <a href="#" onclick="return false;" class="submit-store btn btn-ttc btn-lg" style="margin-bottom:20px;" id="create_store_btn"><span class="glyphicon glyphicon-ok"></span> Yes, I need an online store</a>
                <a href="#" onclick="return false;" class="submit-skip" id="dont-need-store-btn"><h4><u>No, I don’t want to sell products online</u></h4></a>
              </div>
              <div class="item"><!-- 16 -->
                <h2 class="progress-text">Finalizing your new website...</h2>
                <p><img src="images/bird.png" style="margin-bottom:20px;"></p>
                <h3>Wrapping a few things up...</h3>
                <h1>Your website will be ready in a 3,2,1...</h1>
              </div>
              <div class="item"><!-- 17 -->
                <h2 class="progress-text">Your website was created successfuly!</h2>
                <p class="text-center"><span class="glyphicon glyphicon-ok"></p>
                <h1 style="margin-bottom:40px;">Congratulations!</h1>
                <h3 style="margin-bottom:40px;">Your new website is ready<br>and already available on the internet!</h3>
                <h4>You will be automatically directed to your new<br>
                website where you can edit its contents.<br>
                Contact us if you need help at any stage.</h4>
                <a href="#" class="submit btn btn-ttc-orange btn-lg" style="margin-bottom:20px;" id="see-my-website-btn"><img src="images/smiley.png"> Take me to my website</a>
              </div>
            </div>
          </div>
        </div>
    </div><!-- /.container -->


    <!-- Bootstrap core JavaScript -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="js/progress.js/progress.min.js"></script>
    <script src="js/owl-carousel/owl.carousel.js"></script>
    <script src="http://maps.googleapis.com/maps/api/js?sensor=false&amp;libraries=places"></script>
    <script src="js/jquery.geocomplete.min.js"></script>

    <script type="text/javascript">
    $(function () {
        track_event('Loading Page', 'View');

        jQuery('input[type=text]').addClass('LoNotSensitive');

        // start progress-bar for element id='targetElement'
        // owl-carousel init
        $("#owl-slider").owlCarousel({
            navigation:false,
            singleItem:true,
            transitionStyle:"fade",
            //Pagination
            pagination:false,
            paginationNumbers:false,
            //Mouse Events
            dragBeforeAnimFinish:false,
            mouseDrag:false,
            touchDrag:false,
            //Basic Speeds
            slideSpeed:200
        });

        //get carousel instance data and store it in variable owl
        var owl = $("#owl-slider").data('owlCarousel');


        var progressBarOptions = {};
        progressBarOptions.percent_increase = 1;
        progressBarOptions.increaseEveryMsec = 500;

        var progressBarStartTime = new Date().getTime();
        var nextStopSlide = 12;
        var nextStopSlideInPercent;

        var expected_slide_according_to_time;
        var expected_percent_according_to_time;

        var progressBar = progressJs("#progress-bar").start().autoIncrease(progressBarOptions.percent_increase, progressBarOptions.increaseEveryMsec);//.set(0);

        // callback function to call for each change of progress-bar
        progressBar.onprogress(function (targetElm, percent) {
            expected_percent_according_to_time = (new Date().getTime() - progressBarStartTime) / progressBarOptions.increaseEveryMsec * progressBarOptions.percent_increase;
            expected_slide_according_to_time = convertPercentToSlide(expected_percent_according_to_time);
            if(expected_percent_according_to_time > percent+5) {
                temp_slide = Math.min( expected_slide_according_to_time, nextStopSlide);
                if( temp_slide > owl.currentItem) {
                    owl.goTo(temp_slide);
                    percent = convertSlideToPercent(temp_slide);
                    progressBar.set( percent);
                }
            }

            if (owl.currentItem == 12) {
                progressBar.set(convertSlideToPercent(owl.currentItem));

            } else if (owl.currentItem == 14) {
                progressBar.set(convertSlideToPercent(owl.currentItem));
            }

            if (owl.currentItem == owl.maximumItem) {
                progressBar.set(100);
                owl.stop() // Autoplay Stop

            }

            if (percent > convertSlideToPercent(owl.currentItem+1)) {
                owl.next();
            }

            if (percent == 100) {
                $('.progressjs-theme-blue .progressjs-percent').hide();
                progressBar.end();
                owl.stop() // Autoplay Stop
            }
        });

        function convertSlideToPercent(slide) {
            return Math.floor(slide/owl.itemsAmount*100);
        }

        function convertPercentToSlide(percent) {
            return Math.floor(percent/100*owl.itemsAmount);
        }

        $('.submit-skip').click(function (e) {
            e.preventDefault();
            owl.next();
        });


        var options = {
            map:".map_canvas"
        };
        $("#address").trigger("geocode");
        $("#address").geocomplete(options)
                .bind("geocode:result", function (event, result) {
                    //$.log("Result: " + result.formatted_address);
                })
                .bind("geocode:error", function (event, status) {
                    //$.log("ERROR: " + status);
                })
                .bind("geocode:multiple", function (event, results) {
                    //$.log("Multiple: " + results.length + " results found");
                });


        function getParameterByName(name) {
            name = name.replace(/[\[]/, "\\[").replace(/[\]]/, "\\]");
            var regex = new RegExp("[\\?&]" + name + "=([^&#]*)"),
                    results = regex.exec(location.search);
            return results == null ? "" : decodeURIComponent(results[1].replace(/\+/g, " "));
        }

        var page_id = getParameterByName('page_id');

        $('#see-my-website-btn').click(function () {
            window.location.href = window.blog_redirect;
            track_event('Loading Page', 'Show Website');
        });

        if (page_id) {

            createWebsiteUsingAjax(page_id);

            getFacebookPageAddress(page_id);
        }

        function getFacebookPageAddress(page_id) {
            var facebook_query_page_url = "https://graph.facebook.com/" + page_id;
            $.get(facebook_query_page_url, function (data) {
                console.log("the page:" + page_id);
                console.log(data);

                if (data.location != undefined && data.location.latitude != undefined && data.location.longitude != undefined) {
                    delete data.location.latitude;
                    delete data.location.longitude;
                }
                var address_parts = [];

                for (var x in data.location) {
                    address_parts.push(data.location[x]);
                }

                var phone = (data.phone) ? data.phone : "";
                var address = (address_parts.join(", ")) ? address_parts.join(", ") : "";
                var email = (data.email) ? (data.email) : "";

                if (data.likes != undefined) {
                    window.page_type = 'Fan Page';
                } else {
                    window.page_type = 'Personal Page';
                }
                window.parsed_page_data = {
                    'phone':phone,
                    'address':address,
                    'email':email
                }


                $('#address').val(address);
                $('#email').val(email);
                $('#phone').val(phone);

                jQuery('#address').geocomplete('find', jQuery('#address').val());

            }, "json");
        }

        function createWebsiteUsingAjax(page_id) {
            var request_data = {};
            request_data.theme = "parallax";
            request_data.facebook_id = encodeURIComponent(page_id);

            // var request_url = "http://wp.otonomic.com/migration/index.php?" + $.param(request_data);
            var request_url = "http://wp.otonomic.com/migration/index.php";

            $.ajax({
                url: request_url,
                type: "GET",
                dataType: "json",
                 data: request_data

            }).done(
                function (data) {
                    window.is_blog_ready = 1;

                    if (data.redirect.indexOf("http://") < 0) {
                        data.redirect = "http://" + data.redirect;
                    }

                    if (data.site_url.indexOf("http://") < 0) {
                        data.site_url = "http://" + data.site_url;
                    }

                    if (data.status == 'fail') {
                        window.location = data.site_url;
                        track_event('Account Manage', 'Site Exists', data.message);

                    } else {
                        var page_type = window.page_type || 'Fan Page';
                        track_event('Account Manage', 'Create Success', page_type);
                    }

                    // Site created, facebook fixel
                    window._fbq = window._fbq || [];
                    window._fbq.push(['track', facebook_site_created_pixel_id, {'value':'0.00', 'currency':'USD'}]);

                    window.site_url = data.site_url;
                    window.blog_redirect = data.redirect;
                    window.blog_id = data.blog_id;
                    window.token = data.token;

                    $('#see-my-website-btn').attr('href', data.redirect);

                    blog_created();
                }
            );
        }

        function blog_created() {
            if (window.is_contact_saved == 1) {
                send_contact_data();
            }

            if (window.i_need_store == 1) {
                send_need_store();
            }

            return;
        }


        function contact_form_submited() {
            window.is_contact_saved = 1;

            if (window.is_blog_ready == 1) {
                send_contact_data();

            } else {
                window.users_contacts = {
                    'phone':$('#phone').val(),
                    'address':$('#address').val(),
                    'email':$('#email').val()
                }
            }
        }


        function send_contact_data() {

            if (window.users_contacts != undefined) {
                var _phone = window.users_contacts.phone;
                var _email = window.users_contacts.email;
                var _address = window.users_contacts.address;
            } else {
                var _phone = $('#phone').val();
                var _email = $('#email').val();
                var _address = $('#address').val();
            }

            var values_changes = { phone:_phone, address:_address, email:_email}
            // $.post( window.site_url + '/?json=settings.set_many', { values: values_changes });

            request = $.ajax({
                type:"POST",
                url:window.site_url + '/?json=settings.set_many',
                data:{ values:values_changes },
                statusCode:{
                    200:function () {
                        return;
                    },
                    307:function () {
                        $.post(window.site_url + '/?json=settings.set_many', { values:values_changes });
                    }
                }
            });
        }

        function send_need_store() {
            track_event('Loading Page', 'Online Store', 'Yes');
            request = $.ajax({
                type:"POST",
                url:window.site_url + '/?json=store.create',
                statusCode:{
                    200:function () {
                        //doSomething();
                    },
                    307:function () {
                        $.post(window.site_url + '/?json=store.create');
                    }
                }
            });
        }

        function send_dont_need_store() {
            track_event('Loading Page', 'Online Store', 'No');
            request = $.ajax({
                type:"POST",
                url:window.site_url + '/?json=store.hide',
                statusCode:{
                    200:function () {
                        //doSomething();
                    },
                    307:function () {
                        $.post(window.site_url + '/?json=store.hide');
                    }
                }
            });
        }

        $('#contact-form-btn').click(function () {
            contact_form_submited();
            owl.next();
        });

        $('#dont-need-store-btn').click(function () {
            send_dont_need_store();
            owl.next();
        });

        $('#create_store_btn').click(function () {
            if (window.is_blog_ready == 1) {
                send_need_store();

            } else {
                window.i_need_store = 1;
            }
            owl.next();
        });
    });
    </script>
  </body>
</html>
